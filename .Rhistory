dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
dat$name <- na.locf(dat$name)
dat <- dat[!grepl("^_NAME_", dat$speech),]
dat <- dat[!is.na(dat$name_dum),]
dat$code <- NULL
dat$name <- gsub("_NAME_", "", dat$name)
dat$name_dum <- NULL
dat$ind <- NULL
rownames(dat) <- 1:nrow(dat)
date <- gsub(".*/", "", site)
date <- gsub(".html", "", date)
dat$date <- date
df_senate <- rbind(df_senate, dat)
}
site
files[k]
k
files
View(df_senate)
unique(df_senate$name)
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Temporary Speaker", df_senate$name, ignore.case = T)]
df_senate$name[grepl("Temporary Speaker", df_senate$name, ignore.case = T)] <- "Temporary Speaker"
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Temporary Chairperson", df_senate$name, ignore.case = T)] <- "Temporary Chairperson"
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name <- gsub("The Senator for", "", df_senate$name)
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Senate Majority", df_senate$name, ignore.case = T)] <- "Senate Majority Leader"
df_senate$name[grepl("Senate Minority", df_senate$name, ignore.case = T)] <- "Senate Minority Leader"
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Majority", df_senate$name, ignore.case = T)] <- "Senate Majority Leader"
df_senate$name[grepl("Minority", df_senate$name, ignore.case = T)] <- "Senate Minority Leader"
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Deputy Speaker", df_senate$name, ignore.case = T)] <- "Deputy Speaker"
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("The Speaker", df_senate$name, ignore.case = T)] <- "The Speaker"
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name <- gsub(".*Sen. ", "Sen. ", df_senate$name)
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("hon.", df_senate$name, ignore.case = T)]
df_senate$name[grepl("member", df_senate$name, ignore.case = T)]
df_senate <- df_senate[df_senate$name[!grepl("member", df_senate$name, ignore.case = T)],]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate[!grepl("member", df_senate$name, ignore.case = T),]
head(df_senate[!which(grepl("member", df_senate$name, ignore.case = T)),])
head(df_senate[which(!grepl("member", df_senate$name, ignore.case = T)),])
head(df_senate[(!grepl("member", df_senate$name, ignore.case = T)),])
head(df_senate)
df_senate
View(df_senate)
rm(list=ls())
setwd("/Users/idrhee/Downloads/us.sitesucker.mac.sitesucker/info.mzalendo.com/hansard/sitting/senate/")
# read file
files <- list.files()
end <- length(files)-1
#end <- 5
df_senate <- data.frame()
for (k in 1:end){
print(paste(k, "/", end))
site <- files[k]
k
# clean html
htmlCode = readLines(site)
htmlCode <- trimws(htmlCode)
htmlCode <- htmlCode[htmlCode!=""]
htmlCode <- htmlCode[!grepl("^\\(", htmlCode)]
# keep names
htmlCode <- gsub("<strong>", "_NAME_", htmlCode)
htmlCode <- gsub("<h2>:", "", htmlCode)
# keep headers
htmlCode <- gsub("<h2>", "_HEADER_", htmlCode)
# remove all other html tags
cleanFun <- function(htmlString) {
return(gsub("<.*?>", "", htmlString))
}
htmlCode <- cleanFun(htmlCode)
htmlCode <- trimws(htmlCode)
htmlCode <- htmlCode[!grepl("^$", htmlCode)]
# save as data frame
dat <- data.frame(ind=1:length(htmlCode), code=htmlCode)
# remove unnecessary css
first_header_position <- dat$ind[grepl("^_HEADER", dat$code)][1]
dat <- dat[dat$ind>= first_header_position,]
end_header_position <- dat$ind[grepl("^search Hansard", dat$code)][1]
dat <- dat[dat$ind<= end_header_position,]
# fix class
dat$code <- as.character(dat$code)
# remove other unwanted stuff
dat <- dat[!grepl("SENATE DEBATES|^Disclaimer:|SENATEDEBATES", dat$code),]
# fix rowname index
rownames(dat) <- 1:nrow(dat)
dat$ind <- 1:nrow(dat)
# create header placeholder
dat$header <- NA
dat$header_dum <- 1:nrow(dat)
dat$header_dum[grepl("^_HEADER", dat$code)] <- 0
header_index <- as.numeric(dat$ind[grepl("^_HEADER", dat$code)])
dat$header[rownames(dat) %in% header_index] <- dat$code[rownames(dat) %in% header_index]
# merge headers
for (i in 1:length(dat$header_dum)){
if(i<length(dat$header_dum)){
if(dat$header_dum[i]==dat$header_dum[i+1] & dat$header_dum[i]!=0){
dat$header[i] <- paste(dat$code[i], dat$code[i+1])
}
}
if(i>1){
if(dat$header_dum[i]==dat$header_dum[i-1] & dat$header_dum[i]!=0){
dat$header[i] <- paste(dat$code[i], dat$code[i-1])
}
}
}
new_aa <- vector()
aa <- rle(dat$header_dum)$length
for (i in 1:length(aa)){
if(aa[i]>1){
new_val <- c(aa[i], rep(NA, (aa[i]-1)))
} else{
new_val <- aa[i]
}
new_aa <- c(new_aa, new_val)
}
dat$header_dum <- new_aa
more_than_one_header <- dat$ind[which(dat$header_dum>1)]
for (i in more_than_one_header){
dat$header[i] <- paste(dat$code[i:(i+dat$header_dum[i]-1)], collapse = " > ")
}
dat <- dat[!is.na(dat$header_dum),]
dat$header <- gsub("_HEADER_", "", dat$header)
library(zoo)
dat$header <- na.locf(dat$header)
dat <- dat[!grepl("^_HEADER_", dat$code),]
dat$header_dum <- NULL
# merge speeches
dat$name <- NA
dat$speech <- dat$code
dat$name_dum <- 1
dat$name_dum[grepl("^_NAME", dat$code)] <- 0
dat$speech_dum <- NULL
# fix rowname index
rownames(dat) <- 1:nrow(dat)
dat$ind <- 1:nrow(dat)
name_index <- as.numeric(dat$ind[grepl("^_NAME", dat$code)])
dat$name[rownames(dat) %in% name_index] <- dat$code[rownames(dat) %in% name_index]
# merge speeches
new_aa <- vector()
aa <- rle(dat$name_dum)$length
aa
for (i in 1:length(aa)){
if(aa[i]>1){
new_val <- c(aa[i], rep(NA, (aa[i]-1)))
} else{
new_val <- aa[i]
}
new_aa <- c(new_aa, new_val)
}
dat$name_dum <- new_aa
more_than_one_speech_line <- dat$ind[which(dat$name_dum>1)]
for (i in more_than_one_speech_line){
dat$speech[i] <- paste(dat$code[i:(i+dat$name_dum[i]-1)], collapse = " > ")
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
if(is.na(dat$name[1])){
dat <- dat[-1,]
}
dat$name <- na.locf(dat$name)
dat <- dat[!grepl("^_NAME_", dat$speech),]
dat <- dat[!is.na(dat$name_dum),]
dat$code <- NULL
dat$name <- gsub("_NAME_", "", dat$name)
dat$name_dum <- NULL
dat$ind <- NULL
rownames(dat) <- 1:nrow(dat)
date <- gsub(".*/", "", site)
date <- gsub(".html", "", date)
dat$date <- date
df_senate <- rbind(df_senate, dat)
}
df_senate1 <- df_senate
# Descriptive -------------------------------------------------------------
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Temporary Speaker", df_senate$name, ignore.case = T)] <- "Temporary Speaker"
df_senate$name[grepl("Temporary Chairperson", df_senate$name, ignore.case = T)] <- "Temporary Chairperson"
df_senate$name <- gsub("The Senator for", "", df_senate$name)
df_senate$name[grepl("Majority", df_senate$name, ignore.case = T)] <- "Senate Majority Leader"
df_senate$name[grepl("Minority", df_senate$name, ignore.case = T)] <- "Senate Minority Leader"
df_senate$name[grepl("Deputy Speaker", df_senate$name, ignore.case = T)] <- "Deputy Speaker"
df_senate$name[grepl("The Speaker", df_senate$name, ignore.case = T)] <- "The Speaker"
df_senate$name <- gsub(".*Sen. ", "Sen. ", df_senate$name)
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("member", df_senate$name),]
df_senate <- df_senate[!grepl("member", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("hon. ", df_senate$name, ignore.case = T),]
df_senate$name[grepl("hon. ", df_senate$name, ignore.case = T)]
df_senate$name[grepl("an hon. ", df_senate$name, ignore.case = T)]
de_senate <- df_senate[!grepl("an hon. ", df_senate$name, ignore.case = T),]
de_senate <- df_senate[!grepl("an. hon. ", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("an hon. ", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("an. hon. ", df_senate$name, ignore.case = T),]
unique_names
df_senate$name[!grepl("senator", df_senate$name, ignore.case = T)]
df_senate$name[grepl("senator", df_senate$name, ignore.case = T)]
unique(df_senate$name[grepl("senator", df_senate$name, ignore.case = T)])
df_senate <- df_senate[!grepl("senator", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
unique(df_senate$name[grepl("teller", df_senate$name, ignore.case = T)])
df_senate <- df_senate[!grepl("teller", df_senate$name, ignore.case = T),]
unique(df_senate$name[grepl("teller", df_senate$name, ignore.case = T)])
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("Abstention|Abstain|^(|^Noes", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("Abstention|Abstain|^\\(|^Noes", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[nchar(df_senate$name)>2,]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name <- trimws(df_senate$name)
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("^the ", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate1
# Descriptive -------------------------------------------------------------
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Temporary Speaker", df_senate$name, ignore.case = T)] <- "The Temporary Speaker"
df_senate$name[grepl("Temporary Chairperson", df_senate$name, ignore.case = T)] <- "The Temporary Chairperson"
df_senate$name <- gsub("The Senator for", "", df_senate$name)
df_senate$name[grepl("Majority", df_senate$name, ignore.case = T)] <- "The Senate Majority Leader"
df_senate$name[grepl("Minority", df_senate$name, ignore.case = T)] <- "The Senate Minority Leader"
df_senate$name[grepl("Deputy Speaker", df_senate$name, ignore.case = T)] <- "The Deputy Speaker"
df_senate$name[grepl("The Speaker", df_senate$name, ignore.case = T)] <- "The Speaker"
df_senate$name <- gsub(".*Sen. ", "Sen. ", df_senate$name)
df_senate <- df_senate[!grepl("member", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("an hon. ", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("an. hon. ", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("senator", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("teller", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("Abstention|Abstain|^\\(|^Noes", df_senate$name, ignore.case = T),]
df_senate <- df_senate[nchar(df_senate$name)>2,]
df_senate$name <- trimws(df_senate$name)
df_senate <- df_senate[!grepl("^the ", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name <- str_replace_all(df_senate$name, "[[:punct:]]", " ")
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate1
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name[grepl("Temporary Speaker", df_senate$name, ignore.case = T)] <- "The Temporary Speaker"
df_senate$name[grepl("Temporary Chairperson", df_senate$name, ignore.case = T)] <- "The Temporary Chairperson"
df_senate$name <- gsub("The Senator for", "", df_senate$name)
df_senate$name[grepl("Majority", df_senate$name, ignore.case = T)] <- "The Senate Majority Leader"
df_senate$name[grepl("Minority", df_senate$name, ignore.case = T)] <- "The Senate Minority Leader"
df_senate$name[grepl("Deputy Speaker", df_senate$name, ignore.case = T)] <- "The Deputy Speaker"
df_senate$name[grepl("The Speaker", df_senate$name, ignore.case = T)] <- "The Speaker"
df_senate$name <- gsub(".*Sen. ", "Sen. ", df_senate$name)
df_senate <- df_senate[!grepl("member", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("an hon. ", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("an. hon. ", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("senator", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("teller", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("Abstention|Abstain|^\\(|^Noes", df_senate$name, ignore.case = T),]
df_senate <- df_senate[nchar(df_senate$name)>2,]
df_senate$name <- trimws(df_senate$name)
df_senate <- df_senate[!grepl("^the ", df_senate$name, ignore.case = T),]
df_senate$name <- str_replace_all(df_senate$name, "[[:punct:]]", "")
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("Auditor", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate$name <- str_replace_all(df_senate$name, "[[:numeric:]]", "")
df_senate$name <- gsub("\\d", "", df_senate$name)
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("justice", df_senate$name, ignore.case = T),]
df_senate <- df_senate[!grepl("assembly", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("^that", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("Agriculture|Amendment|shall|clause|governments|education|abuse|speaker|motions|drought|committee|policy|water", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
df_senate <- df_senate[!grepl("Agriculture|Amendment|shall|clause|governments|education|abuse|speaker|motions|drought|committee|policy|water|farmers|livestrock|advocate", df_senate$name, ignore.case = T),]
unique_names <- unique(df_senate$name)
unique_names <- unique_names[order(unique_names)]
unique_names
table(df_senate$name)
library(readstata13)
dd <- read.dta13("/Users/idrhee/Dropbox/shared/GSR_ILAR/Data/2_dyadic/0_raw/CEPII_Trade/TRADHIST_WP.dta")
dd <- dd[dd$year >=1990,]
head(dd$SOURCE_TF)
table(dd$SOURCE_TF)
table(dd$iso_d[dd$SOURCE_TF=="COW",])
table(dd$iso_d[dd$SOURCE_TF=="COW"])
table(dd$iso_o[dd$SOURCE_TF=="COW"])
library(dplyr)
dd %>% filter(SOURCE_TF=="COW") %>% select(iso_o, iso_d, year) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o, iso_d, year) %>% tally
14361+726755+40454+545+3+1
table(dd$SOURCE_TF)
(40454+726755)/(14361+726755+40454+545+3+1)*100
(726755)/(14361+726755+40454+545+3+1)*100
(40454)/(14361+726755+40454+545+3+1)*100
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o, iso_d, year) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o, year) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o, year) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o, year) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% tally
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o)
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% unique(iso_o)
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% table(iso_o)
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% count(iso_o)
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% count(iso_o) %>% print(n=200)
dd %>% filter(SOURCE_TF=="COW") %>% group_by(iso_o) %>% count(iso_o, iso_d) %>% print(n=200)
dd %>% filter(SOURCE_TF=="MITC_IP") %>% group_by(iso_o) %>% count(iso_o, iso_d) %>% print(n=200)
dd %>% filter(SOURCE_TF=="MITC_XP") %>% group_by(iso_o) %>% count(iso_o, iso_d) %>% print(n=200)
hugo_build()
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
library(blogdown)
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
install.packages("blogdown")
library(blogdown)
hugo_build()
serve_site()
hugo_build()
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
library(blogdown)
hugo_build()
serve_site()
hugo_build()
serve_site()
hugo_build()
serve_site()
serve_site()
hugo_build()
serve_site()
hugo_build()
serve_site()
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
library(blogdown)
#new_content("/post/kenya2017.rmd")
hugo_build()
serve_site()
# Creating new project
# # hugo new project/my-project-name.md
# hugo_cmd("new project/poli11_winter_2017.md")
serve_site()
hugo_build()
hugo_build()
serve_site()
hugo_build()
serve_site()
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
library(blogdown)
#new_content("/post/kenya2017.rmd")
hugo_build()
serve_site()
# Creating new project
# # hugo new project/my-project-name.md
# hugo_cmd("new project/poli11_winter_2017.md")
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
library(blogdown)
hugo_build()
serve_site()
hugo_build()
serve_site()
hugo_build()
serve_site()
#setwd("/Users/idrhee/Dropbox/_doc/_archive/other/my_website/")
library(blogdown)
#new_content("/post/kenya2017.rmd")
hugo_build()
serve_site()
# Creating new project
# # hugo new project/my-project-name.md
# hugo_cmd("new project/poli11_winter_2017.md")
